version: "3.9"

services:
  postgres:
    image: postgres:15
    container_name: postgres
    restart: always
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: admin123
      POSTGRES_DB: doc_classifier
    ports:
      - "5432:5432"
    volumes:
      - ./postgres:/var/lib/postgresql/data

  minio:
    image: minio/minio
    container_name: minio
    command: server /data --console-address ":9001"
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      MINIO_ROOT_USER: admin
      MINIO_ROOT_PASSWORD: admin123
    volumes:
      - ./minio:/data

  ocr_service:
    build: ./ocr_service
    container_name: ocr_service
    ports:
      - "8000:8000"
    depends_on:
      - postgres
      - minio

  classifier_service:
    build: ./classifier_service
    container_name: classifier_service
    ports:
      - "8080:8080"
    depends_on:
      - ocr_service
      - postgres

  n8n:
   image: n8nio/n8n
   restart: always
   ports:
    - "5678:5678"
   environment:
    DB_TYPE: postgresdb
    DB_POSTGRESDB_HOST: postgres
    DB_POSTGRESDB_PORT: 5432
    DB_POSTGRESDB_DATABASE: doc_classifier
    DB_POSTGRESDB_USER: admin
    DB_POSTGRESDB_PASSWORD: admin123
    N8N_BASIC_AUTH_ACTIVE: 'true'
    N8N_BASIC_AUTH_USER: admin@example.com
    N8N_BASIC_AUTH_PASSWORD: admin123
    N8N_S3_DISABLE_SSL: 'true'
   volumes:
    - ./n8n_data:/home/node/.n8n
   depends_on:
    - postgres


networks:
  default:
    driver: bridge


